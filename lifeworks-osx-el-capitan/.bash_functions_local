func_gh() {
  local path="${1}"
  local url_base="https://github.com"
  local url_company="${url_base}/workivate"
  local url=
  local sub=
  if $(git status > /dev/null 2>&1)
  then
    if [ -n "${path}" ]
    then
      hub browse -- "${path}"
    else
      hub browse
    fi
    return
  fi
  case "${path}" in
    "f"|"feed")
      url="${url_base}"
      ;;
    "p"|"pulls")
      author="$(func_dev2gh "${2}")"
      state="$(echo "${3}" | tr '[:upper:]' '[:lower:]')"
      if [ -z "${author}" ]
      then
         author="markchalloner"
         state="${2}"
      fi
      case "${state}" in
        "o"|"open")
          state="+is%3Aopen"
          ;;
        "c"|"closed")
          state="+is%3Aclosed"
          ;;
        *)
          state=""
          ;;
      esac
      url="${url_base}/pulls?q=is%3Apr+author%3A${author}${state}"
      ;;
    [0-9]*)
      url="${url_company}/wa-api/pull/${path}"
      ;;
    "")
      url="${url_company}"
      ;;
    *)
      path="$(func_projnick2full "${path}")"
      shift 
      sub="${@}"
      sub="${sub// //}"
      sub="${sub//branch/tree}"
      url="${url_company}/${path}/${sub}"
      ;;
  esac
  open "${url}"
}

func_jr() {
  local ticket="${1}"
  local branch=
  local board=224
  local url_base="https://workivate.atlassian.net"
  local url=
  if [ -z "${ticket}" ] && $(git status > /dev/null 2>&1)
  then
    branch="$(git rev-parse --abbrev-ref HEAD)"
    if $(echo "${branch}" | grep -q '^\w\+-\d\+$')
    then
      ticket="${branch}"
    fi
  fi
  case "${ticket}" in
    b|backlog)
      board="${2:-${board}}"
      url="${url_base}/secure/RapidBoard.jspa?rapidView=${board}&view=planning.nodetail"
      ;;
    a|agile)
      board="${2:-${board}}"
      url="${url_base}/secure/RapidBoard.jspa?rapidView=${board}"
      ;;
    h|home|dashboard|"")
      url="${url_base}/secure/Dashboard.jspa"
      ;;
    *)
      ticket="$(echo "${ticket}" | tr '[:lower:]' '[:upper:]' | sed 's/^\([A-Z][A-Z]*\)\([0-9][0-9]*\)/\1-\2/g')"
      if $(echo "${ticket}" | grep -q '^\d\+$')
      then
        ticket="RA-"${ticket}
      fi
      url="${url_base}/browse/${ticket}"
      ;;
  esac
  if [ -n "${url}" ]
  then
    open "${url}"
  fi
}

func_phpstorm() {
  local proj=
  local file=
  if [ $# -ge 2 ]
  then
    proj="$(func_projnick2full "${1}")"
    file="${WA_ROOT}/${proj}/${2}"
  else
    file="${1}"
  fi
  if [ "${file:0:1}" == "/" ] || [ "${file:0:1}" == "~" ] 
  then
    file="${file/\/srv/${HOME}/Vagrant/wa}"
  else
    file="$(pwd)/${file}"
  fi
  /Applications/PhpStorm.app/Contents/MacOS/phpstorm "${file}"
}

func_projnick2full() {
  local nick="${1}"
  local full=
  case "${nick}" in
    android|api|arch|backend|hermes|ios|sso|zeus)
      full="wa-${nick}"
      ;;
    be)
      full="wa-backend"
      ;;
    content)
      full="wa-api-content"
      ;;
    doc)
      full="wa-api-documentation"
      ;;
    infra)
      full="wa-infrastructure"
      ;;
    *)
      full="${nick}"
      ;;
  esac
  echo "${full}"
}
